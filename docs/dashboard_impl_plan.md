# Admin Dashboard Implementation Plan (Phase 3)

## Goal
Transform the static `NewDesign.tsx` mockup into a fully functional "Campaign Management" dashboard for Tenant Admins.

## Proposed Changes

### Backend (`supabase/migrations`)
*   #### [NEW] `20260212_fix_call_logs_company_rls.sql`
    *   **Problem**: Current RLS only allows the original *seller* to view call logs. Admins need to see *all* logs for their company.
    *   **Fix**: Update `call_logs` policy to check `company_id` match via `warranty_prospects` -> `companies` <-> `user_profiles`.

### Frontend (`src/pages/NewDesign.tsx` & Components)
*   #### [REFACTOR] Split `NewDesign.tsx`
    *   Create `src/components/Dashboard/Admin/` directory.
    *   Extract tabs into valid components:
        *   `CampaignBuilder.tsx` (The "Builder" tab).
        *   `LiveQueue.tsx` (The "Live Queue" tab).
        *   `AdminAnalytics.tsx` (The stats section).
    *   Keep `NewDesign.tsx` as the layout shell (sidebar/tabs).

*   #### [NEW] `CampaignBuilder.tsx`
    *   **Read**: Fetch `call_templates` for `user.company_id`.
    *   **Write**: Form to update `system_prompt`, `first_message`, `voice_id`.
    *   **Action**: "Save Changes" button.

*   #### [NEW] `LiveQueue.tsx`
    *   **Read**: Real-time subscription to `call_logs` (joined with `warranty_prospects`).
    *   **Display**: Table showing Customer Name, Status, Duration, Outcome.
    *   **Filter**: By status (Completed, Failed, etc.).

*   #### [NEW] `AdminAnalytics.tsx`
    *   **Aggregations**: Calculate "Close Rate" (Purchase / Total Calls) and "Revenue".
    *   **Display**: Replace hardcoded stats with real data.

## Verification Plan
1.  **RLS Check**: Log in as Admin -> Verify I can see logs generated by the `generic` engine (even if seller is different).
2.  **Template Edit**: Change the `first_message` in Builder -> Save -> Refresh -> Verify persistence.
3.  **Live Log**: Trigger a test call -> See it appear in "Live Queue" instantly.
